<!DOCTYPE html>
<html>
<head>
    <title>My first Vue app</title>
    <script src="https://unpkg.com/vue"></script>
    <!-- Entire bundle; alternative when not using NPM -->
    <script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.8/lib/draggable.bundle.js"></script>
</head>
<body>
<div id="app">
    <div class="header">
        <input class="add border" v-model="taskTitle" @keyup.enter="addTask"/>
        <input class="add border" :placeholder="placeholder" v-model="taskDescription" @keyup.enter="addTask"/>
    </div>
    <div class="wrapper">
        <div class="analysis column border">
            <p>{{ subtitle.analysis }}</p>
            <div class="task border">
                <div class="task-header">Default title</div>
                <div class="task-description">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut aliquam viverra rutrum. Proin purus orci, feugiat a commodo sed, malesuada id metus.
                    Etiam lacinia dui ac libero convallis, varius consequat quam consectetur. Fusce sollicitudin ante tortor, maximus auctor purus condimentum vel.
                    Etiam vitae enim ante. Nunc finibus iaculis quam quis suscipit. In eget sagittis mi. Nam mi lectus, elementum id arcu et, euismod laoreet massa.
                </div>
            </div>
            <div class="task border">
                <div class="task-header">Default title</div>
                <div class="task-description">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut aliquam viverra rutrum. Proin purus orci, feugiat a commodo sed, malesuada id metus.
                    Etiam lacinia dui ac libero convallis, varius consequat quam consectetur. Fusce sollicitudin ante tortor, maximus auctor purus condimentum vel.
                    Etiam vitae enim ante. Nunc finibus iaculis quam quis suscipit. In eget sagittis mi. Nam mi lectus, elementum id arcu et, euismod laoreet massa.
                </div>
            </div>
            <div class="task border">
                <div class="task-header">Default title</div>
                <div class="task-description">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut aliquam viverra rutrum. Proin purus orci, feugiat a commodo sed, malesuada id metus.
                    Etiam lacinia dui ac libero convallis, varius consequat quam consectetur. Fusce sollicitudin ante tortor, maximus auctor purus condimentum vel.
                    Etiam vitae enim ante. Nunc finibus iaculis quam quis suscipit. In eget sagittis mi. Nam mi lectus, elementum id arcu et, euismod laoreet massa.
                </div>
            </div>
            <div class="task border">
                <div class="task-header">Default title</div>
                <div class="task-description">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut aliquam viverra rutrum. Proin purus orci, feugiat a commodo sed, malesuada id metus.
                    Etiam lacinia dui ac libero convallis, varius consequat quam consectetur. Fusce sollicitudin ante tortor, maximus auctor purus condimentum vel.
                    Etiam vitae enim ante. Nunc finibus iaculis quam quis suscipit. In eget sagittis mi. Nam mi lectus, elementum id arcu et, euismod laoreet massa.
                </div>
            </div>
        </div>
        <div class="development column border">
            <p>
                {{ subtitle.development }}
            </p>
        </div>
        <div class="finished column border">
            <p>
                {{ subtitle.finished }}
            </p>
        </div>
    </div>
    <footer></footer>
</div>

<script>
    var STORAGE_KEY = 'tasks-vue-2.0';
    var taskStorage = {
        fetch: function () {
            var tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            console.log('in fetch taskStorage', tasks);
            tasks.forEach(function (task, index) {
                task.id = index;
            });
            taskStorage.uid = tasks.length;
            return tasks;
        },
        save: function (tasks) {
            console.log('saving local storage');
            localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks))
        }
    };

    var app = new Vue({
        el: '#app',
        data: {
            tasks: taskStorage.fetch(),
            taskTitle: "Task #" + (taskStorage.fetch().length + 1),
            taskDescription: '',
            placeholder: 'Description',
            subtitle: {
                analysis: 'Analysis',
                development: 'Development',
                finished: 'Finished'
            },
            errors: []
        },

        watch: {
            tasks: {
                handler: function (tasks) {
                    console.log('in watch handler');
                    taskStorage.save(tasks)
                },
                deep: true
            }
        },
        methods: {
            addTask: function () {
                try {
                    var title = this.taskTitle && this.taskTitle.trim();
                } catch (e) {
                    this.errors.add(e);
                    return;
                }

                var description = this.taskDescription && this.taskDescription.trim();

                this.tasks.push({
                    id: taskStorage.uid++,
                    title: title,
                    description: description,
                    stage: 0
                });

                this.taskDescription = '';
                this.taskTitle = "Task #" + (this.tasks.length + 1);
            },
        }
    })
</script>

<style>
    .wrapper {
        width: 100%;
        min-height: 80vh;
        display: flex;
        justify-content: space-evenly;
        padding-bottom: 5vh;
    }

    .header {
        margin: 10px;
        height: 15vh;
        text-align: center;
    }

    input.add {
        width: 98%;
        height: 40px;
        font-size: 30px;
        background: transparent;
        font-weight: lighter;
        text-align: left;
        letter-spacing: 2px;
        color: rgba(0,0,0,0.5);
        margin-top: 10px;
        padding: 10px;
    }

    input:focus {
        outline: none;
    }

    input::placeholder {
        letter-spacing: 2px;
        color: rgba(0,0,0,0.3);
        font-style: italic;
    }

    footer {
        height: 40px;
        width: 100%;
        background-color: black;
    }

    .column {
        flex: 1;
        margin: 10px;
        background-color: transparent;
        font: 16px bold, sans-serif;
        color: rgba(0,0,0,0.5);
    }

    .column > p {
        text-align: center;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    .task {
        margin: 10px;
    }

    .border {
        border: 1px solid rgba(0,0,0,.5);
        border-radius: 5px;
    }

    .task-header {
        text-align: center;
        color: rgba(0,0,0,.8);
        font-size: 20px;
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .task-description, .task-header {
        padding: 10px;
    }

</style>
</body>
</html>